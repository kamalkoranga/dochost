<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pricing | DocHost</title>
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}" />
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32x32.png') }}" />
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon-16x16.png') }}" />
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 15px;
    }

    body {
      font-family: "Montserrat", sans-serif;
      width: 80%;
      max-width: 1440px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }

    header {
      color: black;
      margin: 3.3rem 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .cards {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    .card {
      background: #fff;
      color: black;
      border-radius: 0.8rem;
    }

    .cards .card.active {
      background: black;
      color: #fff;
      display: flex;
      align-items: center;
      transform: scale(1.1);
      z-index: 1;
    }

    ul {
      margin: 2.6rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
    }

    ul li {
      list-style-type: none;
      display: flex;
      justify-content: center;
      width: 100%;
      padding: 1rem 0;
    }

    ul li.price {
      font-size: 3rem;
      color: black;
      padding-bottom: 2rem;
    }

    .shadow {
      box-shadow: -5px 5px 15px 1px rgba(0, 0, 0, 0.1);
    }

    .card.active .price {
      color: #fff;
    }

    .btn {
      margin-top: 1rem;
      height: 2.6rem;
      width: 13.3rem;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 4px;
      background: black;
      color: #fff;
      outline: none;
      border: 0;
      font-weight: bold;
      cursor: pointer;

      &.link {
        text-decoration: none;
      }

      &:hover {
        background: #333;
        color: #fff;
      }
    }

    .active-btn {
      background: #fff;
      color: black;

      &:hover {
        background: #fff;
        color: black;

      }
    }

    .bottom-bar {
      border-bottom: 2px solid black;
    }

    .card.active .bottom-bar {
      border-bottom: 2px solid white;
    }

    .pack {
      font-size: 1.1rem;
    }

    .storage-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;

      .storage-label {
        font-size: 0.98em;
        color: black;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
      }
    }

    @media (max-width: 280px) {
      ul {
        margin: 1rem;
      }

      h1 {
        font-size: 1.2rem;
      }

      .toggle {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        align-items: center;
        height: 80px;
      }

      .cards {
        margin: 0;
        display: flex;
        flex-direction: column;
      }

      .card {
        transform: scale(0.8);
        margin-bottom: 1rem;
      }

      .cards .card.active {
        transform: scale(0.8);
      }
    }

    @media (min-width: 280px) and (max-width: 320px) {
      ul {
        margin: 20px;
      }

      .cards {
        display: flex;
        flex-direction: column;
      }

      .card {
        margin-bottom: 1rem;
      }

      .cards .card.active {
        transform: scale(1);
      }
    }

    @media (min-width: 320px) and (max-width: 414px) {
      .cards {
        display: flex;
        flex-direction: column;
      }

      .card {
        margin-bottom: 1rem;
      }

      .cards .card.active {
        transform: scale(1);
      }
    }

    @media (min-width: 414px) and (max-width: 768px) {
      .card {
        margin-bottom: 1rem;
        margin-right: 1rem;
      }

      .cards .card.active {
        transform: scale(1);
      }
    }

    @media (min-width: 768px) and (max-width: 1046px) {
      .cards {
        display: flex;
      }

      .card {
        margin-bottom: 1rem;
        margin-right: 1rem;
      }

      .cards .card.active {
        transform: scale(1);
      }


    }
  </style>
</head>

<body>
  <header>
    <h1>Our Pricing</h1>
  </header>
  <div class="cards">
    <!-- Current Plan Card -->
    <div class="card active" id="current-plan-card">
      <ul id="current-plan-list">
        <li class="pack">Current Plan</li>
        <li id="current-plan" class="price bottom-bar">Free</li>
        <li class="bottom-bar">5 MB Storage</li>
        <li class="bottom-bar">No Expiry</li>
        <li><button class="btn active-btn" disabled>Current</button></li>
      </ul>
    </div>
    <!-- 2₹ Plan Card -->
    <div class="card shadow">
      <ul>
        <li class="pack">Basic</li>
        <li id="basic" class="price bottom-bar">₹2</li>
        <li class="bottom-bar">+5 MB Storage</li>
        <li class="bottom-bar">Valid for 1 minute</li>
        <li><button class="btn" id="buy-basic">Buy</button></li>
      </ul>
    </div>
    <!-- 4₹ Plan Card -->
    <div class="card shadow">
      <ul>
        <li class="pack">Professional</li>
        <li id="professional" class="price bottom-bar">₹4</li>
        <li class="bottom-bar">+10 MB Storage</li>
        <li class="bottom-bar">Valid for 1 minute</li>
        <li><button class="btn" id="buy-professional">Buy</button></li>
      </ul>
    </div>
  </div>
  <div id="sub-result" style="margin-top: 3em; margin-bottom: 1em; color: #38a169; text-align: center;"></div>
  <div class="storage-section">
    <div id="storage-bar-visual"></div>
    <div id="storage-info"></div>
    <a class="btn link" href="{{ url_for('main.index') }}" style="margin-top:10px; margin-bottom: 2em; background:black;">Go to
      Dashboard</a>
  </div>
  <!-- Add this modal HTML just before the closing </body> tag -->
  <div id="payment-modal"
    style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:1000;justify-content:center;align-items:center;">
    <div
      style="background:#fff;padding:2em 2em 1.5em 2em;border-radius:10px;box-shadow:0 2px 16px rgba(0,0,0,0.18);display:flex;flex-direction:column;align-items:center;min-width:260px;max-width:90vw;">
      <h2 style="margin-bottom:1em;">Scan to Pay</h2>
      <div id="qrcode" style="margin-bottom: 1rem;"></div>
      <button id="simulate-pay-btn" class="btn" style="margin-bottom:0.5em;">Simulate Payment</button>
      <button onclick="closeModal()" class="btn" style="background:#eee;color:#333;">Cancel</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      function subscribe(amount) {
        fetch('/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount: amount })
        })
          .then(r => r.json())
          .then(data => {
            document.getElementById('sub-result').innerText = data.message || (data.error ? data.error : "");
            getStorageInfo();
          });
      }
      function getStorageInfo() {
        fetch('/storage-info')
          .then(r => r.json())
          .then(data => {
            // Storage bar
            let usedMB = (data.used / 1024 / 1024);
            let totalMB = (data.total / 1024 / 1024);
            let percent = Math.min(100, (usedMB / totalMB) * 100).toFixed(1);
            let bar = `
                    <div class="storage-bar-bg" style="width:100%;height:18px;background:#fff;border:2px solid black;border-radius:9px;margin:5px 0 6px 0;overflow:hidden;">
                        <div class="storage-bar-fill" style="height:100%;background:black;border-radius:9px 0 0 9px;transition:width 0.4s;width:${percent}%"></div>
                    </div>
                    <div class="storage-label">
                        <p>
                        Used: ${usedMB.toFixed(2)} MB / ${totalMB.toFixed(2)} MB (${percent}%)
                        </p>
                        <p>
                        Free: ${(data.free / 1024 / 1024).toFixed(2)} MB
                        </p>
                        ${data.subscription_expires_at ? `` : '<br><span style="color:#e53e3e;">No active subscription</span>'}
                    </div>
                `;
            document.getElementById('storage-bar-visual').innerHTML = bar;
            document.getElementById('storage-info').innerText = "";

            // Update Current Plan Card
            let planList = document.getElementById('current-plan-list');
            let isSubscribed = !!data.subscription_expires_at;
            let planName = "Free";
            let storage = "5 MB Storage";
            let expiry = "No Expiry";
            let btn = `<button class="btn active-btn" disabled>Current</button>`;
            if (isSubscribed) {
              // Show as "Subscribed"
              planName = "Subscribed";
              storage = (data.total / 1024 / 1024).toFixed(0) + " MB Storage";
              expiry = `Expires: ${new Date(data.subscription_expires_at).toLocaleString()}`;
            }
            planList.innerHTML = `
                    <li class="pack">Current Plan</li>
                    <li id="current-plan" class="price bottom-bar">${planName}</li>
                    <li class="bottom-bar">${storage}</li>
                    <li class="bottom-bar">${expiry}</li>
                    <li>${btn}</li>
                `;
          });
      }
      // Auto-load storage info
      getStorageInfo();

      let selectedAmount = 0;

      function showModal(amount) {
        selectedAmount = amount;
        const upiLink = `upi://pay?pa=kamalkoranga13@oksbi&pn=Kamal%20Koranga&am=${amount}&cu=INR`;
        const qrcodeContainer = document.getElementById('qrcode');
        qrcodeContainer.innerHTML = '';
        new QRCode(qrcodeContainer, {
          text: upiLink,
          width: 200,
          height: 200
        });
        document.getElementById('payment-modal').style.display = 'flex';
      }

      window.closeModal = function () {
        document.getElementById('payment-modal').style.display = 'none';
      }

      document.getElementById('simulate-pay-btn').onclick = function () {
        closeModal();
        subscribe(selectedAmount);
      };

      document.getElementById('buy-basic').onclick = function () { showModal(2); };
      document.getElementById('buy-professional').onclick = function () { showModal(4); };
    });
  </script>
</body>

</html>